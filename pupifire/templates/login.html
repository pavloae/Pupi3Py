{% load static %}

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Sample FirebaseUI App</title>
        <script src="https://www.gstatic.com/firebasejs/ui/4.4.0/firebase-ui-auth__es_419.js"></script>
        <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.4.0/firebase-ui-auth.css" />

    </head>
    <body>

        <!-- The surrounding HTML is left untouched by FirebaseUI.
         Your app may use that space for branding, controls and other customizations.-->
        <h1>Bienvenido a Pupi3</h1>
        <h3>Login</h3>

        <div id="is-new-user"></div>

        <div id="firebaseui-auth-container"></div>

        <!-- Insert these scripts at the bottom of the HTML, but before you use any Firebase services -->

        <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-app.js"></script>

        <!-- Add Firebase products that you want to use -->
        <script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-firestore.js"></script>


        <script>
        // TODO: Replace the following with your app's Firebase project configuration
        const firebaseConfig = {
              apiKey: "AIzaSyDmk-4phXqH4BjGgEkGc2rRiZf2ofguWi8",
              authDomain: "aula31-e5dd1.firebaseapp.com",
              databaseURL: "https://aula31-e5dd1.firebaseio.com",
              projectId: "aula31-e5dd1",
              storageBucket: "aula31-e5dd1.appspot.com",
              messagingSenderId: "1069993443421",
              appId: "1:1069993443421:web:873c974f3016b773"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        </script>

        <script type="text/javascript">
            // FirebaseUI config.
            var uiConfig = {
                signInSuccessUrl: "{% url 'index' %}",
                signInOptions: [
                    // Leave the lines as is for the providers you want to offer your users.
                    // firebase.auth.GoogleAuthProvider.PROVIDER_ID,
                    // firebase.auth.FacebookAuthProvider.PROVIDER_ID,
                    // firebase.auth.TwitterAuthProvider.PROVIDER_ID,
                    // firebase.auth.GithubAuthProvider.PROVIDER_ID,
                    firebase.auth.EmailAuthProvider.PROVIDER_ID,
                    {
                        provider: firebase.auth.PhoneAuthProvider.PROVIDER_ID,
                        defaultCountry: 'AR'
                    },
                    firebaseui.auth.AnonymousAuthProvider.PROVIDER_ID,
                ],
                // tosUrl and privacyPolicyUrl accept either url string or a callback
                // function.
                // Terms of service url/callback.
                tosUrl: "{% url 'tos' %}",
                // Privacy policy url/callback.
                privacyPolicyUrl: function() {
                  window.location.assign("{% url 'privacy-policy' %}");
                },
                'callbacks': {
                    'signInSuccessWithAuthResult': function(authResult, redirectUrl) {
                    if (authResult.user) {
                        var user = authResult.user;
                        console.log("Phone: " + user.phoneNumber);
                        console.log("Name: " + user.displayName);
                        console.log("Uid: " + user.uid.toString());
                        handleSignedInUser(user);
                    }
                    if (authResult.additionalUserInfo) {
                      document.getElementById('is-new-user').textContent =
                          authResult.additionalUserInfo.isNewUser ?
                          'New User' : 'Existing User';
                    }
                    // Do not redirect.
                    return false;
                  }
                },

            };

            function handleSignedInUser(user){
                user.getToken().then(function(idToken) {
                    console.log("Token: " + idToken);
                });
            }

            // Initialize the FirebaseUI Widget using Firebase.
            var ui = new firebaseui.auth.AuthUI(firebase.auth());
            // The start method will wait until the DOM is loaded.
            ui.start('#firebaseui-auth-container', uiConfig);
        </script>

    </body>
</html>